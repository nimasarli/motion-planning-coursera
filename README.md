# Motion Planning for Self-Driving Cars
## Objectives
The goal of the project are as follows:
- Write a planner to navigate a given scenario of ubran driving that includes avoiding a static obstacle (a parked vehicle in the lane), following a lead vehicle, decelerate to stop at a stop sign, ..
- Develop a state machine for behavior planning
- Use a Conformal Lattice Planner to generate paths to avoid static obstacles
- Generate velocity profiles to avoid dynamic vehicles

## Path Planner
- Goal points were found by finding the points that were ahead of the ego vehicle on the set of waypoints within a pre-defined distance.
- Goal points were generated by laterally offseting these points. This was done by laterally sampling offsets from the goal location along the direction perpendicular to the goal yaw.
- A cubic spiral was used to model every trajectory and an optimization problem was solved with L-BFGS-B method to find the coefficients of the spiral that result in minimum bending energy of a path.

### Collision Detection & Path Selection
The vehicle was bounded by circles. The paths that led to collisions were excluded (marked by red). The best path in the remaining paths was selected according to how closely it followed the lane centerline, and how far away it was from other paths that were in collision. The best path is marked by black.

## Velocity Profile Generation
It takes a path, and computes a velocity profile to the goal speed. Two velocity porfiles were used according to the scenario at hand:
- decelerate_to_stop to decelerate to a stop line. A trapezoidal velocity profile was used. 
- follow_lead_vehicle to follow a lead vehicle. A ramp velocity profile was used to reach a target velocity.

The order of precedence for handling these cases were stop sign handling, lead vehicle handling, lane maintenance. For simplicity, each of these cases were assumed be independant.

## Behavioral Planner
- Behavior planner informs outputs to local planner (path planning and velocity profile generator)
- State machine with three states:
    1) lane following (includes lead vehicle following)
    2) decelerate to stop
    3) stay stopped
  
## Results
The following shows the results in CARLA simulator.


